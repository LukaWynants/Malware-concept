# Getting started

## Encryption

### for the attacker:
1. The first thing you have to do is generate a key pair for the attackers decryption/encryption

you can generate a key pair using the attacker module /attacker/attacker_modules/generate_attacker_keys.py

    python generate_attacker_keys.py

this will generate 2 keys in the attacker_modules folder.


2. Now you have to move the 2 keys out of the attacker_modules folder and to the parent directory /attacker

you can do this with the following command:

    mv private_attacker.pem ..
    mv public_attacker.pem ..

### For the victim:
1. For the victim, you have to ensure that it has the 'public_attacker.pem' key in its folder /victim/.

Make sure this is the same attacker public key as the one you generated before.

## Running the code

### Folder structure:
before running the code your folder structure should look like this:

    |-/attacker/
        |- attacker_modules.py
        |- main_attacker_framework.py
        |- public_attacker.pem
        |- private_attacker.pem
    |-/victim/
        |- victim_modules
        |- main.py
        |- public_attacker.pem

### Starting the attacker framework first
Firstly you have to start the attacker framework in /attacker/:

    python attacker_framework.py

This will start the socket based exfiltration server, it is default listening on your local host port 9000 as this is a proof of concept, the attacker framework will wait untill it recieves data from the victim.

### Starting the victim framework
*note*: make sure the attackers public key is in the /victim/ folder

Now that the exfiltration server from the attacker is running you have to start a victims malware in /victim/:

    python main.py

#### The malware will first configure the encryption of the victim:

1. A public and private key is created for the victim
2. The attackers public key is used to encrypt the victims private key, this is later written to the exfil file so the attacker can use his private key to decrypt the victims private key which ultimatley decrypts the exfil data 
3. The Victims private key and attacker public key is now overwritten, by overwriting these 2 keys the victims private key is unrecoverable, only the attacker can decrypt it
4. Now only the public key of the victim is left, which will be used to encrypt the exfil data.

I chose this strategy so that each victim has a diffrent decryption key

#### The malware will now try to collect various system information:
1. General windows system info
2. antivirus detection
3. All the WIFI SSIDs the system has ever connected to
4. The passwords of these SSIDs
5. IP information
6. Other devices on the LAN of the system

#### The malware will now encrypt and exfil the stolen data and encrypted victim private key:

1. all the stolen data will first be added to a dictionary:

       {
       "Detected OS": OS,
       "System information stolen": system_info,
       "detected antivirus softwore": antivirus,
       "IP info gathered" : ip_info,
       "Found local SSIDS" : ssids,
       "wifi passwords stolen" : wifi_passwords,
       "other network devices found" : found_lan_devices
       }
3. The dictionary will be converted to a json string
4. The json string will be encrypted using the victims public key
5. Each victim gets a ID attached to the exfil file
6. The encrypted private key will be written to the exfil file along with the encrypted json string, "---" is used as a separator to identify the key and data
7. The victim will connect to the attacker server (localhost port 9000 POC) and send over the exfil file

#### The Attacker_framework will now recieve the exfil file
1. The exfil file is recieved
2. The victims private key will first be read from the file and decrypted using the attackers private key
3. The victims private key will be stored in a file called private_key_victim_<victim_id>.PEM
4. The victims stolen information will be read and decrypted by the private key of the victim
5. The information will be sent to the output file

# Wip:
- add automatic public key sending from the attacker to the victim
- add the browser password decryption module
- I would like the server to exfil over dns records instead of sockets
