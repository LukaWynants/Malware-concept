import threading
import ping3
import nmap

def ping(ip, LAN_ips):
    """
    a function which pings a host and adds it to the LAN_ips list if its up
    """
    success = ping3.ping(ip)
    if success:
        LAN_ips.append(ip)
        return True
    else:
        return False

def ping_range(prefix, start, end):
    """
    a function which will ping every device on the network and add the up ones to a list
    this function uses threads so it executes faster (a for loop and timeouts with ping took too long)
    """
    LAN_ips = [] #list to add all the up lan ips on the victims LAN

    threads = []
    for ip in range(start, end):
        ip_addr = prefix + str(ip)
        #create a new thread that runs the ping function with the ip address
        thread = threading.Thread(target=ping, args=(ip_addr, LAN_ips))
        threads.append(thread) #start the thread and move to the next one
        thread.start()

    # this ensures all the threads are done before the next part of the code is executed
    for thread in threads:
        thread.join()

    return LAN_ips

def nmap_scan(host):
    nm = nmap.PortScanner()

    nm.scan(host, '0-8080', arguments='-O')  # Perform the scan

    return nm
    
    

#testing the code
if __name__ == "__main__":
    print("Local up IPs:", ping_range("192.168.2.",0, 255))